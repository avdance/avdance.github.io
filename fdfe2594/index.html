<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/avdance32_32.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/avdance16_16.ico"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"blog.avdancedu.com",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:"valine",storage:!0,lazyload:!1,nav:null,activeClass:"valine"},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="在《音视频会议系统-janus的安装与布署》一文中我已经向你介绍了如何布署janus，今天我们再来了解一下janus的源码，看看janus包括哪些文件以及它们所起的作用是什么。"><meta property="og:type" content="article"><meta property="og:title" content="janus各文件及目录的作用"><meta property="og:url" content="https://blog.avdancedu.com/fdfe2594/index.html"><meta property="og:site_name" content="音视跳动科技"><meta property="og:description" content="在《音视频会议系统-janus的安装与布署》一文中我已经向你介绍了如何布署janus，今天我们再来了解一下janus的源码，看看janus包括哪些文件以及它们所起的作用是什么。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.avdancedu.com/image/article/janus_file/janus_arch.jpg"><meta property="article:published_time" content="2020-06-28T11:57:29.000Z"><meta property="article:modified_time" content="2020-06-29T05:31:43.573Z"><meta property="article:author" content="音视跳动"><meta property="article:tag" content="janus"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.avdancedu.com/image/article/janus_file/janus_arch.jpg"><link rel="canonical" href="https://blog.avdancedu.com/fdfe2594/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>janus各文件及目录的作用 | 音视跳动科技</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="音视跳动科技" type="application/atom+xml"></head><body itemscope itemtype="https://schema.org/WebPage"><div class="container"><div class="headband"></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div><header class="header" itemscope itemtype="https://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">音视跳动科技</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">传播最前沿的科技知识！</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> 首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i> 关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/avdance" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="https://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.avdancedu.com/fdfe2594/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="image" content="/images/avdancelogo.jpg"><meta itemprop="name" content="音视跳动"><meta itemprop="description" content="传输最前沿的科技知识，学习音视频的圣地！ffmpeg, webrtc, H264, AAC"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="音视跳动科技"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> janus各文件及目录的作用</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-06-28 19:57:29" itemprop="dateCreated datePublished" datetime="2020-06-28T19:57:29+08:00">2020-06-28</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-06-29 13:31:43" itemprop="dateModified" datetime="2020-06-29T13:31:43+08:00">2020-06-29</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/WebRTC/" itemprop="url" rel="index"><span itemprop="name">WebRTC</span></a></span></span><span id="/fdfe2594/" class="post-meta-item leancloud_visitors" data-flag-title="janus各文件及目录的作用" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/fdfe2594/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/fdfe2594/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>3.5k</span></span></div></header><div class="post-body" itemprop="articleBody"><p><img data-src="https://cdn.avdancedu.com/image/article/janus_file/janus_arch.jpg" alt="janus架构图"></p><p>在<a href="https://avdancedu.com/ed54b3d4/" target="_blank" rel="noopener">《音视频会议系统-janus的安装与布署》</a>一文中我已经向你介绍了如何布署<code>janus</code>，今天我们再来了解一下<code>janus</code>的源码，看看<code>janus</code>包括哪些文件以及它们所起的作用是什么。</p><a id="more"></a><h2 id="下载-janus-源码"><a href="#下载-janus-源码" class="headerlink" title="下载 janus 源码"></a>下载 janus 源码</h2><p><code>janus</code>源码可以在<a href="https://github.com/meetecho/janus-gateway" target="_blank" rel="noopener">这里</a>找到，执行下面命令就可将其下载下来：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;meetecho&#x2F;janus-gateway.git</span><br><span class="line">cd janus-gateway</span><br></pre></td></tr></table></figure><h2 id="janus各源码文件的作用"><a href="#janus各源码文件的作用" class="headerlink" title="janus各源码文件的作用"></a>janus各源码文件的作用</h2><p>下载好<code>janus</code>源码后，你可以看到<code>janus</code>目录下有很多文件，这里我列出了比较重要的几个文件，下面来说明一下它们起所的作用是什么。目录列表如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">events           # 主要用于各种事件消息的分析</span><br><span class="line">plugins          # 各种业务插件，所有的业务应用都在这里实现</span><br><span class="line">transports       # 用于处理各种网络信令，HTTP、WebSocket、MQTT等</span><br><span class="line">docs             <span class="meta"># janus的文档，它是通过 Doxygen 生成的，janus的文档还是很全面的</span></span><br><span class="line">html             # Web端的Demo都放在这里</span><br><span class="line">rtcp.h           # RTCP 是RTP的控制协议</span><br><span class="line">rtcp.c           # RTCP 协议的具体实现</span><br><span class="line">rtp.c            # RTP协议的实现，它用于传输音视频数据</span><br><span class="line">rtp.h            # RTP 协议的头文件</span><br><span class="line">rtpsrtp.h        # SRTP 协议</span><br><span class="line">sctp.c           # SCTP 协议的实现</span><br><span class="line">sctp.h           # SCTP 协议的头文件</span><br><span class="line">sdp.c            # SDP 协议的实现</span><br><span class="line">sdp.h            # SDP 协议的头文件</span><br><span class="line">sdp-utils.c      # 处理 SDP 的常用工具</span><br><span class="line">sdp-utils.h</span><br><span class="line">test             # 测试文件所在目录</span><br><span class="line">record.c         <span class="meta"># janus的录制功能在该文件中实现</span></span><br><span class="line">record.h</span><br><span class="line">ice.c            <span class="meta"># janus 使用 libnice 实现 ICE 功能，该文件是对libnice库的封装</span></span><br><span class="line">ice.h</span><br><span class="line">janus.c          # 该文件是janus的主框架程序，里边做了很多事儿</span><br><span class="line">janus.h</span><br><span class="line"><span class="built_in">log</span>.c            # 日志</span><br><span class="line"><span class="built_in">log</span>.h</span><br><span class="line">dtls-bio.c       # DTLS 中 BIO 的实现</span><br><span class="line">dtls-bio.h</span><br><span class="line">dtls.c           # DTLS 协议实现</span><br><span class="line">dtls.h</span><br><span class="line">events.c         # 配合events插件与janus core连接用的</span><br><span class="line">events.h</span><br></pre></td></tr></table></figure><p>对于上面的文件我们可能将它们分成几大类：</p><ul><li>业务插件，<code>plugins</code>目录下的所有文件都属于该类，其主要作用是实现不同的业务逻辑的服务端，如<code>echotest</code>、<code>videoroom</code>、<code>videocall</code>等。</li><li>事件分析，<code>events</code>目录下的所有文件以及<code>events.c|h</code>，其作用是收集事件消息，做分析使用。这个功能只能高级用户才会用，对于一般用户来说可以不关注它。</li><li>协议，包括 <code>rtp.c|h</code>、<code>rtcp.c|h</code>、<code>rtpsrtp.h</code>、<code>stcp.c|h</code>、<code>sdp.c|h</code>、<code>dtls.c|h</code>、<code>dtls-bio.c|h</code>，这些都是用于处理不同协议的，每个文件都比较独利。</li><li>日志，包括 <code>log.c|h</code>，这个应该一眼就可以看出来。</li><li>浏览器Demo，<code>html</code>目录中的所有文件，主要包括一些demo程序，如videoroom、echotest等。</li><li>信令传输，<code>transports</code>目录下的文件属于该类，作用是接收不同传输协议发送过来的消息，并使用同样的协议将响应消息返回。</li><li>数据传输，<code>ice.c|h</code>，它是对<code>libnice</code>库的封装，用于媒体数据的传输。</li><li>janus核心，<code>janus.c|h</code>，这是<code>janus</code>中最核心的文件，程序的启动，插件的加载，数据的流转都是通过它来实现的。</li></ul><p>在上面几个类别中， <strong>janus核心</strong>、<strong>数据传输</strong>、<strong>信令传输</strong>、<strong>业务插件</strong>、<strong>浏览器Demo</strong> 中的代码是比较重要的，所以是你在阅读代码时需要重点看的内容。由于<strong>信令传输</strong>、<strong>业务插件</strong>、<strong>浏览器Demo</strong>都是目录，里边还包括了很多文件，所以下面我们再来看看这三个目录中都包括了那些文件。</p><h3 id="信令传输"><a href="#信令传输" class="headerlink" title="信令传输"></a>信令传输</h3><p>进入到 <code>transports</code> 目录，你会它有以下几个文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">transport.h             # 定义了&#96;信令传输&#96;插件的接口</span><br><span class="line">transport.c             # 定义了几个通用的释放资源的函数</span><br><span class="line">janus_http.c            # HTTP 接口，默认使用的接口</span><br><span class="line">janus_mqtt.c            # MQTT 接口，编译时需要明确指定才会编入janus</span><br><span class="line">janus_pfunix.c          # UNIX 接口</span><br><span class="line">janus_nanomsg.c         # NanoMSG 接口</span><br><span class="line">janus_rabbitmq.c        # RabbitMQ 接口</span><br><span class="line">janus_websockets.c      # Websocket 接口</span><br></pre></td></tr></table></figure><p><code>janus</code>支持的信令接口方式还是蛮全的，这是它的一大优势。用户可以选择自己喜欢的接入方式进行接入。通过上面的描述你应该很容易判断出每个文件的作用，你对那个感兴趣就可以专门看那个文件。默认情况下<code>janus</code>使用的是HTTP接口，因此该接口也是最成熟的。</p><h3 id="业务插件"><a href="#业务插件" class="headerlink" title="业务插件"></a>业务插件</h3><p><code>janus</code>支持很多业务插件，这对于很多用户来说也是一个非常棒的特点，我们来看一下它都支持那些插件吧。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">plugin.h                # 定义了业务插件的接口</span><br><span class="line">plugin.c                # 实现了一些公用的释放资源的函数</span><br><span class="line">janus_echotest.c        # 回显业务插件</span><br><span class="line">janus_videocall.c       # 1:1视频通讯业务插件</span><br><span class="line">janus_videoroom.c       # 会议业务插件</span><br><span class="line">janus_textroom.c        # 文本聊天室插件</span><br><span class="line">janus_streaming.c       # 传输直接流插件，可以播放视频文件，或其它的RTP数据流</span><br><span class="line">streams</span><br><span class="line">janus_recordplay.c      # 录制回放业务插件</span><br><span class="line">recordings</span><br><span class="line">janus_sip.c             # sip 业务插件，主要用于与电话业务的互通</span><br><span class="line">janus_nosip.c           # 包含sip信令业务插件，用它可以中转RTP数据</span><br><span class="line">janus_audiobridge.c     # 音频会议插件</span><br><span class="line">janus_voicemail.c       # 语言信箱业务插件</span><br><span class="line">janus_lua.c             # lua 语言开发插件</span><br><span class="line">janus_lua_extra.h</span><br><span class="line">janus_lua_extra.c</span><br><span class="line">janus_lua_data.h</span><br><span class="line">lua</span><br><span class="line">janus_duktape.c         # duktape语言插件</span><br><span class="line">janus_duktape_extra.h</span><br><span class="line">janus_duktape_extra.c</span><br><span class="line">janus_duktape_data.h</span><br><span class="line">duktape</span><br><span class="line">duktape-deps</span><br></pre></td></tr></table></figure><p>通过上面的文件列表，我们看到<code>janus</code>支持的插件可真不少，有会议视会议的、1：1通话的、SIP、RTP、流…等等。这些插件几乎含盖的所有的业务场景。对于用户来话，要以根据自己的需求选择上面的业务插件进行修改即可完成自己的业务了。</p><p>最后我们再来看看客户端 Demo。</p><h3 id="HTML-Demo"><a href="#HTML-Demo" class="headerlink" title="HTML Demo"></a>HTML Demo</h3><p>在<code>janus</code>的html目录中有很多文件，其中大部分文件是与上面<code>业务插件</code>中的内容是对应的。也就是说一个业务插件对应一个HTML Demo。所以这块的内容大家自己看一下就可以了。我就不在这里一一列出来了。</p><p>通过上面的描述，我们大体上可以知道<code>janus</code>的实现并不是特别复杂。它实现了RTP/RTCP、SRTP、SCTP、DTLS/DTLS-BIO、SDP 等 WebRTC 必要的协议，而对于数据的传输则是使用<code>libnice</code> 库，并通过<code>ice.c|h</code>对libnice 做了一层封装。</p><p>除此之外，它所有的业务层都是以<code>plugin</code>的方式实现的，这对于后面的业务拓展有很大的优势。当我们要实现一个新业务时，只要按照 plugin 的规则进行开发就好了，非常简单。</p><p>另外，janus是用纯C实现的，并且使用了Linux社区丰常优秀的库<code>glib</code>(注意不是glibc)，这个库的性能非常好，对于在Linux 下开发的同学来说对它应该十分熟悉。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>通过本文，你应该对<code>janus</code>的源码有了一个大体功能的了解。由于<code>WebRTC</code>使用了很多的协议（如 RTP/RTCP、DTLS、SDP等），因此作为服务端的<code>janus</code>也必须实现这些协议，这样才能与<code>WebRTC</code>进行通信。</p><p>对于<code>janus</code>使用的这些协议可能很多同学会觉得一脸懵B，不知道其中的原理和作用，如果你对这块感兴趣的话，可以去看我的网课<a href="https://coding.imooc.com/class/329.html" target="_blank" rel="noopener">《WebRTC入门》</a>，在课程里我对这些协议都做了详细介绍。</p><p>如果你有一定基础的话，现在应该知道<code>janus</code>的实现并不是特别复杂，但它的架构设计还是很值得借鉴的，尤其是<code>plugin</code>的设计方案。</p><p>今天我只是对<code>janus</code>做个初步分析，后面会对它的一些性能做下详细分析，静请期待！</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://coding.imooc.com/class/329.html" target="_blank" rel="noopener">《WebRTC入门》</a></li><li><a href="https://coding.imooc.com/class/387.html" target="_blank" rel="noopener">《百万级高并发WebRTC流媒体服务器设计与开发》</a></li><li><a href="https://time.geekbang.org/column/intro/207" target="_blank" rel="noopener">《从0打造音视频直播系统》</a></li></ul></div><div class="reward-container"><div></div> <button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'> 打赏</button><div id="qr" style="display:none"><div style="display:inline-block"> <img src="https://cdn.avdancedu.com/image/next/wechat.jpeg" alt="音视跳动 微信支付"><p>微信支付</p></div><div style="display:inline-block"> <img src="https://cdn.avdancedu.com/image/next/alipay.jpeg" alt="音视跳动 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>本文作者：</strong> 音视跳动-李超 [avdance@163.com]</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://blog.avdancedu.com/fdfe2594/" title="janus各文件及目录的作用">https://blog.avdancedu.com/fdfe2594/</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="https://cdn.avdancedu.com/image/next/WeChat.jpeg"><span class="icon"><i class="fa fa-wechat"></i></span> <span class="label">WeChat</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i></span> <span class="label">RSS</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/janus/" rel="tag"><i class="fa fa-tag"></i> janus</a></div><div class="post-nav"><div class="post-nav-item"><a href="/ed54b3d4/" rel="prev" title="音视频会议系统-janus的编译与布署"><i class="fa fa-chevron-left"></i> 音视频会议系统-janus的编译与布署</a></div><div class="post-nav-item"> <a href="/aafa6b93/" rel="next" title="janus深入分析系列文章">janus深入分析系列文章<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#下载-janus-源码"><span class="nav-number">1.</span> <span class="nav-text">下载 janus 源码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#janus各源码文件的作用"><span class="nav-number">2.</span> <span class="nav-text">janus各源码文件的作用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#信令传输"><span class="nav-number">2.1.</span> <span class="nav-text">信令传输</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#业务插件"><span class="nav-number">2.2.</span> <span class="nav-text">业务插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTML-Demo"><span class="nav-number">2.3.</span> <span class="nav-text">HTML Demo</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小结"><span class="nav-number">3.</span> <span class="nav-text">小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">4.</span> <span class="nav-text">参考</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="https://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="音视跳动" src="/images/avdancelogo.jpg"><p class="site-author-name" itemprop="name">音视跳动</p><div class="site-description" itemprop="description">传输最前沿的科技知识，学习音视频的圣地！ffmpeg, webrtc, H264, AAC</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">26</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/avdance" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;avdance" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/garrylea/posts" title="ZhiHu → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;garrylea&#x2F;posts" rel="noopener" target="_blank"><i class="fa fa-fw fa-zhihu"></i> ZhiHu</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="https://www.beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备19056322号-1</a> <img src="/images/beianico.png" style="display:inline-block"><a href="https://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11011102001366" rel="noopener" target="_blank">京公网安备11011102001366号</a></div><div class="copyright"> &copy; <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">李超</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span title="站点总字数">180k</span></div><script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              Counter('post', '/classes/Counter', { title, url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"Cu6h7B3RnNt3uEMrRWpVlIU6-gzGzoHsz","app_key":"5dKv9XFD2w3gjJnb0xnWIIWz","server_url":"https://leancloud.cn","security":false};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        //if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script>AV.initialize("Cu6h7B3RnNt3uEMrRWpVlIU6-gzGzoHsz","5dKv9XFD2w3gjJnb0xnWIIWz")</script><script>function showTime(e){var t=new AV.Query(e),c=[],u=$(".leancloud_visitors");u.each(function(){c.push($(this).attr("id").trim())}),t.containedIn("url",c),t.find().done(function(e){var t=".leancloud-visitors-count";if(0!==e.length){for(var n=0;n<e.length;n++){var o=e[n],i=o.get("url"),s=o.get("time"),r=document.getElementById(i);$(r).find(t).text(s)}for(n=0;n<c.length;n++){i=c[n],r=document.getElementById(i);var l=$(r).find(t);""==l.text()&&l.text(0)}}else u.find(t).text(0)}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(i){var e=$(".leancloud_visitors"),s=e.attr("id").trim(),r=e.attr("data-flag-title").trim(),t=new AV.Query(i);t.equalTo("url",s),t.find({success:function(e){if(0<e.length){var t=e[0];t.fetchWhenSave(!0),t.increment("time"),t.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var n=new i,o=new AV.ACL;o.setPublicReadAccess(!0),o.setPublicWriteAccess(!0),n.setACL(o),n.set("title",r),n.set("url",s),n.set("time",1),n.save(null,{success:function(e){$(document.getElementById(s)).find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):1<$(".post-title-link").length&&showTime(e)})</script><link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.min.css"><script src="/lib/needsharebutton/needsharebutton.min.js"></script><script>flOptions={iconStyle:"box",boxForm:"horizontal",position:"topRight",networks:"Weibo,Wechat,QQZone"},new needShareButton("#needsharebutton-float",flOptions)</script><script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('/lib/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Cu6h7B3RnNt3uEMrRWpVlIU6-gzGzoHsz',
      appKey     : '5dKv9XFD2w3gjJnb0xnWIIWz',
      placeholder: "畅所欲言？",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script></body></html>